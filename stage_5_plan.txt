# Schema Cleanup: Stage 5 - Admin Tables (Deferred)

This file documents the planned changes for Stage 5, which were designed but NOT implemented.

## Objectives
1.  Fix broken `FeedbackModel` (currently references undefined `db.feedback`).
2.  Fix incorrect `CustomerAnalytics` (currently uses `BrandInfo` as placeholder).
3.  Cleanup `AdminModel.js` hardcoded data.

## Detailed Implementation Steps

### 1. Create Feedback Schema
**File:** `config/FeedbackMongo.js` (New File)
**Action:** Create a standard Mongoose schema.
```javascript
const { mongoose } = require('../models/mongoDB');

const feedbackSchema = new mongoose.Schema({
    user_id: { type: mongoose.Schema.Types.ObjectId, required: true, refPath: 'user_type' },
    user_type: { type: String, required: true, enum: ['BrandInfo', 'InfluencerInfo'] }, // Dynamic ref
    subject: { type: String, required: true, trim: true },
    message: { type: String, required: true },
    status: { type: String, default: 'pending', enum: ['pending', 'reviewed', 'resolved'] },
    admin_response: { type: String },
    created_at: { type: Date, default: Date.now },
    updated_at: { type: Date, default: Date.now }
}, { timestamps: true });

const Feedback = mongoose.model('Feedback', feedbackSchema);
module.exports = { Feedback };
```

### 2. Update AdminModel Logic
**File:** `models/AdminModel.js`
**Action:** Refactor `FeedbackModel` class.
-   Import: `const { Feedback } = require('../config/FeedbackMongo');`
-   `getAllFeedback`: `return await Feedback.find().populate('user_id', 'brandName fullName email').lean();`
-   `getFeedbackById`: `return await Feedback.findById(id).populate('user_id').lean();`
-   `updateFeedbackStatus`: `return await Feedback.findByIdAndUpdate(id, { status }, { new: true });`

### 3. Fix Customer Analytics
**File:** `models/AdminModel.js`
**Action:** Refactor `AnalyticsModel.getCustomerAnalytics` class.
-   Import: `const { Customer } = require('../config/CustomerMongo');`
-   `totalUsers`: `await Customer.countDocuments();`
-   `activeUsers`: `await Customer.countDocuments({ status: 'active' });` (or based on `last_purchase_date`)
-   `topCustomers`: `await Customer.find().sort({ total_spent: -1 }).limit(5).lean();`

### 4. Verification
-   Ensure `Customer` model is correctly populated (Stage 3).
-   Test creating feedback via API or script to ensure new schema works.
