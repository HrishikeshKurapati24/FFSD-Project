<!-- location: project/views/brand/B2_trasationp.ejs -->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand to Influencer Payment</title>
    <link rel="stylesheet" href="/B2_index/transaction.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo">CollabSync</div>
            <nav>
                <ul>
                    <li><a href="/brand/home">Home</a></li>
                    <li><a href="/brand/explore">Explore Influencers</a></li>
                    <li><a href="/brand/profile">My Brand Profile</a></li>
                    <!-- <li><a href="logout">Logout</a></li> -->
                </ul>
            </nav>
        </div>
    </header>

    <!-- Sidebar Navigation (Right Side) -->
    <button class="toggle-btn" onclick="openMenu()">â˜°</button>
    <div class="menu" id="navMenu">
        <span class="close-btn" onclick="closeMenu()">&times;</span>
        <!-- <a href="/I_explore">Brands</a> //////////////////////////////////////////////////////////////////////////////////////////////////////-->
        <a href="/brand/collab">Collabs</a>
        <a href="/brand/recievedRequests">Collab requests</a>
        <a href="/brand/create_collab">Create Collab</a>
        <a href="/brand/create_offer">Create Offer</a>
        <a href="/brand/signout">Sign Out</a>
        <!-- <a href="#">Settings</a> -->
    </div>


    <div class="container">
        <!-- Success Message Alert -->
        <% if (typeof successMessage !=='undefined' && successMessage) { %>
            <div class="alert alert-success" id="successAlert">
                <i class="fas fa-check-circle"></i>
                <%= successMessage %>
                    <button type="button" class="close-alert" onclick="closeAlert()">&times;</button>
            </div>
            <% } %>

                <!-- Campaign Section -->
                <div class="campaign-section">
                    <h1>
                        <%= campaignTitle %>
                    </h1>
                    <p class="description">
                        <%= campaignDescription %>
                    </p>
                    <div class="campaign-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar"></i>
                            <span>Duration: <%= campaignDuration %></span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-dollar-sign"></i>
                            <span>Budget(in $): <%= campaignBudget %></span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-users"></i>
                            <span>Target Audience: <%= campaignTargetAudience %></span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-chart-line"></i>
                            <span>Min Followers: <%= campaignMinFollowers.toLocaleString() %></span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Start Date: <%= campaignStartDate %></span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-calendar-check"></i>
                            <span>End Date: <%= campaignEndDate %></span>
                        </div>
                    </div>
                    <div class="required-channels">
                        <h3>Required Channels:</h3>
                        <div class="channel-badges">
                            <% if (campaignRequiredChannels && campaignRequiredChannels.length> 0) { %>
                                <% campaignRequiredChannels.forEach(channel=> { %>
                                    <span class="channel-badge">
                                        <%= channel %>
                                    </span>
                                    <% }); %>
                                        <% } else { %>
                                            <span class="no-channels">No specific channels required</span>
                                            <% } %>
                        </div>
                    </div>
                    <div class="objectives">
                        <h3>Campaign Objectives:</h3>
                        <p>
                            <%= campaignObjectives %>
                        </p>
                    </div>
                </div>

                <!-- Influencer Section -->
                <div class="influencer-section">
                    <img src="<%= influencerImage %>" alt="Influencer Profile" class="influencer-pic">
                    <div class="influencer-details">
                        <h2>
                            <%= influencerName %>
                        </h2>
                        <p>Username: <span class="username">@<%= influencerUsername %></span></p>
                        <p>
                            <%= socialPlatform %>: <span class="social-handle">@<%= socialHandle %></span>
                        </p>
                        <p>Status: <span class="status <%= isVerified ? 'verified' : 'unverified' %>">
                                <%= isVerified ? 'Verified' : 'Unverified' %>
                            </span></p>
                    </div>
                </div>

                <!-- Payment Form -->
                <section class="payment-section">
                    <h3>Make Payment</h3>
                    <form id="paymentForm" method="POST"
                        action="/brand/<%= requestId1 %>/<%= requestId2 %>/transaction">
                        <div class="form-group">
                            <label for="amount">Amount (USD)</label>
                            <input type="number" id="amount" name="amount" step="0.01" min="1" max="<%= paymentMax || 0 %>"
                                placeholder="Up to <%= paymentDue?.replace('$', '') || '0' %>" required>
                        </div>
                        <div class="form-group">
                            <label for="paymentMethod">Payment Method</label>
                            <select id="paymentMethod" name="paymentMethod" required>
                                <option value="" disabled selected>Select payment method</option>
                                <option value="creditCard">Credit Card</option>
                                <option value="bankTransfer">Bank Transfer</option>
                            </select>
                        </div>
                        <!-- Credit Card Fields -->
                        <div id="creditCardFields" style="display: none;">
                            <div class="form-group">
                                <label for="cardNumber">Card Number</label>
                                <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456"
                                    maxlength="19">
                            </div>
                            <div class="form-group">
                                <label for="expiryDate">Expiry Date</label>
                                <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY" maxlength="5">
                            </div>
                            <div class="form-group">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="4">
                            </div>
                            <div class="form-group">
                                <label for="cardHolder">Cardholder Name</label>
                                <input type="text" id="cardHolder" name="cardHolder"
                                    placeholder="<%= influencerName %>">
                            </div>
                        </div>
                        <!-- Bank Transfer Fields -->
                        <div id="bankTransferFields" style="display: none;">
                            <div class="form-group">
                                <label for="accountNumber">Account Number</label>
                                <input type="text" id="accountNumber" name="accountNumber" placeholder="1234567890">
                            </div>
                            <div class="form-group">
                                <label for="routingNumber">Routing Number</label>
                                <input type="text" id="routingNumber" name="routingNumber" placeholder="021000021">
                            </div>
                            <div class="form-group">
                                <label for="bankName">Bank Name</label>
                                <input type="text" id="bankName" name="bankName" placeholder="Example Bank">
                            </div>
                        </div>
                        <button type="submit">Submit Payment</button>
                    </form>
                </section>

                <script>
                    // Load Poppins font
                    const link = document.createElement('link');
                    link.href = 'https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap';
                    link.rel = 'stylesheet';
                    document.head.appendChild(link);

                    // Function to close alert
                    function closeAlert() {
                        const alert = document.getElementById('successAlert');
                        if (alert) {
                            alert.style.display = 'none';
                        }
                    }

                    // Auto-hide success alert after 5 seconds
                    const successAlert = document.getElementById('successAlert');
                    if (successAlert) {
                        setTimeout(() => {
                            successAlert.style.display = 'none';
                        }, 5000);
                    }

                    // JavaScript for interactivity
                    const paymentMethodSelect = document.getElementById('paymentMethod');
                    const creditCardFields = document.getElementById('creditCardFields');
                    const bankTransferFields = document.getElementById('bankTransferFields');
                    const paymentForm = document.getElementById('paymentForm');

                    // Toggle payment fields based on method
                    paymentMethodSelect.addEventListener('change', function () {
                        creditCardFields.style.display = this.value === 'creditCard' ? 'block' : 'none';
                        bankTransferFields.style.display = this.value === 'bankTransfer' ? 'block' : 'none';
                    });

                    // Form submission handling
                    paymentForm.addEventListener('submit', function (event) {
                        event.preventDefault();

                        // Collect form data
                        const amount = document.getElementById('amount').value;
                        const paymentMethod = paymentMethodSelect.value;
                        let isValid = true;
                        let errorMessage = '';

                        // Basic validation
                        if (!amount || amount <= 0) {
                            errorMessage += 'Please enter a valid amount.\n';
                            isValid = false;
                        }

                        // Enforce remaining budget client-side
                        const max = Number(document.getElementById('amount').getAttribute('max') || 0);
                        if (max && Number(amount) > max) {
                            errorMessage += `Amount exceeds remaining budget (max ${max}).\n`;
                            isValid = false;
                        }

                        if (!paymentMethod) {
                            errorMessage += 'Please select a payment method.\n';
                            isValid = false;
                        }

                        if (paymentMethod === 'creditCard') {
                            const cardNumber = document.getElementById('cardNumber').value;
                            const expiryDate = document.getElementById('expiryDate').value;
                            const cvv = document.getElementById('cvv').value;
                            const cardHolder = document.getElementById('cardHolder').value;

                            if (!cardNumber || cardNumber.length < 16) {
                                errorMessage += 'Please enter a valid card number (min 16 digits).\n';
                                isValid = false;
                            }
                            if (!expiryDate || !/^\d{2}\/\d{2}$/.test(expiryDate)) {
                                errorMessage += 'Please enter a valid expiry date (MM/YY).\n';
                                isValid = false;
                            }
                            if (!cvv || cvv.length < 3) {
                                errorMessage += 'Please enter a valid CVV (3-4 digits).\n';
                                isValid = false;
                            }
                            if (!cardHolder) {
                                errorMessage += 'Please enter the cardholder name.\n';
                                isValid = false;
                            }
                        } else if (paymentMethod === 'bankTransfer') {
                            const accountNumber = document.getElementById('accountNumber').value;
                            const routingNumber = document.getElementById('routingNumber').value;
                            const bankName = document.getElementById('bankName').value;

                            if (!accountNumber) {
                                errorMessage += 'Please enter an account number.\n';
                                isValid = false;
                            }
                            if (!routingNumber) {
                                errorMessage += 'Please enter a routing number.\n';
                                isValid = false;
                            }
                            if (!bankName) {
                                errorMessage += 'Please enter a bank name.\n';
                                isValid = false;
                            }
                        }

                        // Submit form if valid
                        if (isValid) {
                            this.submit();
                        } else {
                            alert(errorMessage);
                        }
                    });

                    //nav bar
                    function openMenu() {
                        document.getElementById("navMenu").style.width = "250px";
                    }
                    function closeMenu() {
                        document.getElementById("navMenu").style.width = "0";
                    }
                </script>
</body>

</html>