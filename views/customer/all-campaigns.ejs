<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %> - CollabSync
    </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/c_index/campaign-shopping.css">
    <style>
        /* Match brand received_requests visual system */
        .navbar {
            background: #ffffff !important;
            border-bottom: 1px solid #e6e9f0;
            box-shadow: 0 4px 14px rgba(17, 17, 17, .06);
        }

        .navbar .navbar-brand {
            color: #111111;
        }

        .navbar .nav-link {
            color: #6c757d;
        }

        .navbar .nav-link:hover,
        .navbar .nav-link.active {
            color: #0d6efd;
            font-weight: 600;
        }

        .navbar .btn-primary {
            background: #0d6efd;
            border-color: #0d6efd;
        }

        .navbar .btn-primary:hover {
            background: #0b5ed7;
            border-color: #0b5ed7;
        }

        .navbar .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all .2s ease;
        }

        .navbar .form-control:focus {
            box-shadow: 0 0 0 3px rgba(66, 133, 244, .1);
            border-color: #4285f4;
        }

        .campaign-card {
            border-radius: 12px;
            background: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform .2s ease, box-shadow .2s ease;
        }

        .campaign-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
        }

        .brand-logo-container .brand-logo {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            object-fit: cover;
            border: 2px solid #e0e0e0;
            background: #fff;
        }

        .campaign-title {
            font-weight: 700;
            color: #1f2937;
        }

        .stat-number {
            font-weight: 700;
            font-size: 1.25rem;
            color: #1f2937;
        }

        .stat-label {
            color: #6b7280;
            font-size: .85rem;
        }

        .badge.border {
            border: 1px solid #e0e0e0 !important;
            background: #f8fafc !important;
            color: #1f2937 !important;
            font-weight: 600;
        }

        .btn-primary {
            background: #4285f4;
            border: none;
            font-weight: 700;
            border-radius: 10px;
            padding: .65rem 1rem;
            transition: transform .2s ease, box-shadow .2s ease;
        }

        .btn-primary:hover {
            background: #2e70e3;
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(66, 133, 244, .25);
        }

        .btn-outline-secondary {
            border: 2px solid #e0e0e0;
            color: #374151;
            font-weight: 600;
            border-radius: 10px;
            padding: .6rem 1rem;
        }

        .btn-outline-secondary:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        /* Modal refinements */
        #campaignModal .modal-content {
            border: none;
            border-radius: 14px;
            box-shadow: 0 12px 28px rgba(0, 0, 0, .15);
        }

        #campaignModal .modal-header {
            border-bottom: 1px solid #f1f3f4;
        }

        #campaignModal .modal-body .bg-light {
            background: #f8fafc !important;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid d-flex justify-content-between align-items-center px-4">
            <div class="d-flex align-items-center">
                <a class="navbar-brand fw-bold" href="/customer"><i class="fas fa-shopping-bag me-2"></i>CollabSync</a>
                <ul class="nav ms-3">
                    <li class="nav-item"><a class="nav-link active" href="/customer">All Campaigns</a></li>
                    <li class="nav-item"><a class="nav-link" href="/customer/rankings">Rankings</a></li>
                </ul>
            </div>
            <div class="d-flex align-items-center">
                <div class="input-group me-3">
                    <input type="text" id="search" class="form-control" placeholder="Search campaigns...">
                    <button class="btn btn-outline-secondary" type="button">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <a class="btn btn-primary" href="/customer/cart">
                    <i class="fas fa-shopping-cart me-2"></i>Cart
                </a>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-3">
                    <i class="fas fa-fire me-2 text-primary"></i>
                    <%= title %>
                </h1>
                <p class="lead text-muted">Discover amazing products from your favorite brands and influencers</p>
            </div>
        </div>
    </div>

    <!-- Campaigns Grid -->
    <div class="container mt-4">
        <div class="row" id="campaigns-container">
            <% if (campaigns && campaigns.length> 0) { %>
                <% campaigns.forEach(campaign=> { %>
                    <div class="col-md-6 col-lg-4 mb-4 campaign-item">
                        <div class="card h-100 campaign-card shadow-sm border-0"
                            style="border-radius:16px; overflow:hidden; transition:transform .2s, box-shadow .2s;">
                            <div class="card-body d-flex flex-column" style="padding:1.25rem 1.25rem 1rem;">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="brand-logo-container me-3">
                                        <img src="<%= campaign.brand_id.logoUrl %>"
                                            alt="<%= campaign.brand_id.brandName %>" class="brand-logo"
                                            onerror="this.onerror=null; this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    </div>
                                    <h5 class="card-title mb-0">
                                        <%= campaign.brand_id.brandName %>
                                    </h5>
                                </div>

                                <h6 class="campaign-title mb-3">
                                    <i class="fas fa-bullhorn me-2"></i>
                                    <%= campaign.title %>
                                </h6>

                                <p class="card-text flex-grow-1 text-muted" style="min-height:3.2em">
                                    <%= campaign.description.substring(0, 140) %>...
                                </p>

                                <div class="campaign-dates mb-2">
                                    <small class="text-success">
                                        <i class="fas fa-calendar-alt me-1"></i>
                                        Ends: <%= new Date(campaign.end_date).toLocaleDateString() %>
                                    </small>
                                </div>

                                <!-- Influencers Participating -->
                                <% if (campaign.influencers && campaign.influencers.length) { %>
                                    <div class="mb-3">
                                        <div class="d-flex align-items-center mb-2"
                                            style="gap:8px;color:#6b7280;font-weight:600;"><i class="fas fa-users"></i>
                                            Influencers</div>
                                        <div class="d-flex flex-wrap" style="gap:8px;">
                                            <% campaign.influencers.slice(0,6).forEach(function(inf){ %>
                                                <span class="badge bg-light text-dark border">
                                                    <i class="fas fa-user-circle me-1"></i>
                                                    <%= inf.name %>
                                                </span>
                                                <% }) %>
                                                    <% if (campaign.influencers.length> 6) { %>
                                                        <span class="badge bg-light text-dark border">+<%=
                                                                campaign.influencers.length - 6 %> more</span>
                                                        <% } %>
                                        </div>
                                    </div>
                                    <% } %>

                                        <!-- Required Channels (customer-relevant) -->
                                        <% if (campaign.required_channels && campaign.required_channels.length) { %>
                                            <div class="mb-3">
                                                <div class="d-flex align-items-center mb-2"
                                                    style="gap:8px;color:#6b7280;font-weight:600;"><i
                                                        class="fas fa-share-alt"></i> Channels</div>
                                                <div class="d-flex flex-wrap gap-2">
                                                    <% campaign.required_channels.forEach(function(ch){ %>
                                                        <span class="badge bg-light text-dark border"><i
                                                                class="fas fa-hashtag me-1"></i>
                                                            <%= ch %>
                                                        </span>
                                                        <% }) %>
                                                </div>
                                            </div>
                                            <% } %>

                                                <div class="campaign-stats mb-2">
                                                    <div class="row text-center g-0">
                                                        <div class="col-6">
                                                            <div class="stat-number">
                                                                <%= Math.max(0, Math.floor((new Date(campaign.end_date)
                                                                    - new Date()) / (1000 * 60 * 60 * 24))) %>
                                                            </div>
                                                            <div class="stat-label">Days Left</div>
                                                        </div>
                                                        <div class="col-6">
                                                            <div class="stat-number">
                                                                <%= (campaign.budget || 0).toLocaleString('en-US', {
                                                                    style: 'currency' , currency: 'USD' }) %>
                                                            </div>
                                                            <div class="stat-label">Budget</div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="campaign-actions mt-auto">
                                                    <a href="/customer/campaign/<%= campaign._id %>/shop"
                                                        class="btn btn-primary w-100 mb-2">
                                                        <i class="fas fa-shopping-bag me-2"></i>Shop Now
                                                    </a>

                                                </div>
                            </div>
                        </div>
                    </div>
                    <% }); %>
                        <% } else { %>
                            <div class="col-12">
                                <div class="text-center py-5">
                                    <i class="fas fa-calendar-times text-muted" style="font-size: 4rem;"></i>
                                    <h3 class="mt-3">No Active Campaigns</h3>
                                    <p class="text-muted">There are no active campaigns at the moment. Check back soon!
                                    </p>
                                    <a href="/customer" class="btn btn-primary">
                                        <i class="fas fa-home me-2"></i>Go Home
                                    </a>
                                </div>
                            </div>
                            <% } %>
        </div>
    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Search functionality
        document.addEventListener('DOMContentLoaded', function () {
            const searchInput = document.getElementById('search');

            if (searchInput) {
                searchInput.addEventListener('input', debounce(performSearch, 300));
            }
        });

        function performSearch() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const campaignItems = document.querySelectorAll('.campaign-item');

            campaignItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>

</html>